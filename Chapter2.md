# 2장 리팩토링 원칙

* 리팩토링 정의
  * 소프트웨어의 **겉보기 동작은 유지한 채**, 코드를 **이해하고 수정하기 쉽도록** 내부 변경
* 2개의 모자
  * 목적성 구분
    => 기능 추가시에는 기능 추가만 리팩토링시에는 오로지 리팩토링만
  * commit comments rule 을 잘 활용 (feat, refactor)
* 리팩토링의 이유
  * 설계가 좋아짐
    * 중복코드 제거
  * 소프트웨어 이해하기 쉬워짐
    * 의도를 명확하게 개선하므로 다음에 읽을 때 이해가 쉬워짐
  * 버그 찾기에 용의
    * 리팩토링을 통해 소프트웨어를 더 이해했으므로 
    * 가독성이 좋아지므로
  * 프로그래밍 속도 향상
    * 신규 기능을 추가 할 때 마다 점점 시간이 오래 걸림 => 새로 개발하는게 좋겠다 V2 개발
    > 새로운 똥을 만드는것 (a.k.a. 자바지기 박재성님)
* 리팩토링 필요 시점
  * 비슷한 일을 3번 째 하면 리팩토링
    * xquare 에는 아직 비슷한 일이 3번 이상된 곳이 많음
  * 준비를 위한 리팩토링: 기능을 쉽게 추가 하게 만들기
    * 기능 추가시 우려 되는 부분 미리 리팩토링
  * 이해를 위한 리팩토링: 코드 이해를 쉽게 만들기
    * refactor: RegisterMyXquareEvent -> GetPermissionInvestorEvent 로 이름 변경 
  * 쓰레기 줍기 리팩토링
    * refactor: DateValid 삭제 및 common 패키지 변경
    * 안쓰는 DateValid annotation 삭제
  * 계획된 리팩토링과 수시로 하는 리팩토링
    * 수시로 하는 리팩토링시 기능 개발시에 확인하는 경우가 많음 => 개인적으로는 커밋을 나누기 애매한 경우 기능 추가 커밋에 포함시킴  
  * 오래걸리는 리팩토링
    * 조금씩 해결하는게 효과적 
    * xquare admin v2 api 로 전환 => 조금씩 진행중
  * 코드 리뷰에 리팩토링
    * 리팩토링 아이디어 전달
  * 관리자에게 뭐라고 말할까?
    * 관리자는 빨래 끝내는걸 가장 선호
    * 결론적으로 **프로그래밍 속도 향상** 을 위해 필요한 과정이라고 어필해야함
  * 리팩토링하지 말아야 할때
    * 전혀 상황을 모르고 리팩토링 부터 하면 안됨
* 리팩토링 시 고려할 점
  * 새 기능 개발 속도 저하
    * 준비를 위한 리팩토링을 하면 변경이 훨씬 쉬워짐
    * 리팩토링은 필수
  * 코드 소유권
    * 소유권을 확인하여 진행해야함 
    * 오픈소스의 개발 모델 => 병합 요청은 누구나 가능하지만 반영은 오픈소스 팀이 반영 
  * 브랜치
    * 개발 기간이 길어지면 안됨 => 짧은 주기로 지속적 통합 해야함
    * xquare 경우 master 배포가 주기가 길어 통합과정이 힘들었음
  * 테스팅
    * 리팩토링을 하기 위해서는 자가 테스트 코드 필요 
    * 안전한 자동 리팩토링이라면 테스트 필요 없음
    * 자가 테스트 코드는 리팩토링 뿐만 아니라 새 기능 추가도 훨씬 안전하게 가능
  * 레거시 코드
    * 테스트 코드가 필요
    * 관련된 부분끼리 나눠서 공략
  * 데이터베이스
    * 작고 독립된 단계로 분리
    * 프로덕션 환경에서는 병렬 수정 => 개인적으로는 적용하기 매우 어렵지 않을까 생각 
* 아키텍처, 애그니(YAGNI)
  * 아키텍쳐도 대폭 변경 가능 => xquare admin v2 의 entity 와 domain
* 개발 프로세스
  * TDD
* 리팩토링과 성능
  * 실제로 성능이 느려질수 있음 
  * 기능 추가를 빨리하고 성능 튜닝에 집중할 시간 확보
  * 튜닝시 세밀한 분석 가능
  * 결국 최적화 단계에서 튜닝에 유리해져 성능에 도움을 줌
* 유래, 자동화, 참고문헌